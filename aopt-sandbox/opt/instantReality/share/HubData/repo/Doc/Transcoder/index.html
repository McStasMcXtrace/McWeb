<html><header></header><body>

<h1>Transcoder REST API Description</h1>

<ul>
  <li><i>/</i> - Frontpage</li><br>
  <li><i>/job/list</i> - Job list</li><br>
  <li><i>/job/list/json</i> - Job list, JSON encoded</li><br>
  <li><i>/job/<ID></i> - Job <ID> description</li><br>
  <li><i>/job/delete?id=[ID]</i> - deletes Job <ID></li><br>
  <li><i>/job</i> - POST: add jobs, GET: list jobs 
    <ul><br>
      <li>Jobs can be added through POST http requests.
        <ul><br>
          <li>POST request - expects a JSON file describing the job parameters
            (see Examples below). The service class must be set to
            TranscoderService <tt> "ServiceClass" : "TranscoderService"</tt>
          </li> 
          <li>Jobs can either utilise predefined operations 
            <tt> "type" : "PreDefOps"</tt> or secure command batches 
            <tt> "type" : "SecCmdBatch"</tt> 
          <li>Return value:
            <ul>
              <li>default: returns ID of new job if successful (ie job doesn't
                already exist), if the job already exists its ID is returned, 0
                in case of errors
              </li> 
              <li>if 'redirect' (see list of parameters below): it will return
                a 302 (redirect) HTTP code with an adress derived from the job
                (ID, output type) and the delivery_service command line
                parameter of transcoder
              </li> 
            </ul>
          </li>
        </ul>
      </li><br>
      <li>The following parameters are supported for <b>predefined operations</b>:
        <ul><br>
          <li><b>type</b> [<i>string</i>] - must be "PreDefOps"
          </li>
          <li><b>resource</b> [<i>string</i>] - uri that gets pulled
          </li>
          <li><b>ops</b> [<i>comma seperated list of strings</i>]
            <ul>
              <li><b>optimizations</b> (note that you should not attempt this
              operation <i>after</i> converting to e.g. binary or image
              geometry - <b>ops order does matter</b>!):
                <ul> 
                  <li><i>collapse</i> - merge all objects ignoring materials -
                    the result will look <i>different</i> (only one
                    material)
                  </li> 
                  <li><i>collapse+id</i> - like collapse, but will also
                    generate an idmap
                  </li> 
                  <li><i>restructure</i> - (1) merge <i>same materials</i> (2)
                    split into nodes with max 64k vertices - the result will
                    look <i>identical</i>, but is optimized for rendering
                  </li> 
                  <li><i>restructure+id</i> - like restructure, but will also
                    generate an idmap
                  </li> 
                  <li><i>restructure_atlas</i> - (1) merge <i>same
                      materials</i> (2) merge w/ texture atlas (3) split into
                    nodes with max 64k vertices - the result will
                    look <i>identical</i>, but is optimized for rendering
                  </li> 
                  <li><i>restructure_atlas+id</i> - like restructure_atlas,
                    but will also generate an idmap
                  </li> 
                  <li><i>collapse_restructure</i> - (1) merge <i>all objects
                      ignoring materials</i> (2) split into nodes with max 64k
                    trianlges - the result will look <i>different</i> and is max
                    optimized for rendering
                  </li> 
                  <li><i>collapse_restructure+id</i> - like
                    collapse_restructure, but will also generate an idmap
                  </li>
                  <li><i>reuse</i> - attempts to identify subtrees that can be
                    referenced
                  </li> 
                </ul>
              </li>
              <li><b>conversions</b>:
                <ul>
                  <li><i>toBinGeo</i> - convert to Binary geometry</li>
                  <li><i>toPopGeo</i> - convert to POP geometry</li>
                  <li><i>toSRC</i> - convert to SRC geometry</li>
                  <li><i>toImageGeo</i> - convert to Image Geometry (not
                    recommended anymore since feature is deprecated)
                  </li> 
                </ul>
              </li>
            </ul>
          </li>
          <li><b>format</b> [<i>string</i>] - the output format
            <ul>
              <li><b>x3d</b> - X3D</li>
              <li><b>vrml</b> - VRML</li>
              <li><b>html</b> - HTML5/X3DOM</li>
              <li><b>json</b> - HSI</li>
            </ul>
          </li>
          <li><b>reply</b> [<i>string</i>] - the reply format
            <ul>
              <li><b>redirect</b> - redirect to the transcoded result</li>
              <li><b>result</b>   - URI of the transcoded result</li>
              <li><b>path</b>     - URI of the result folder</li>
              <li><b>id</b>       - job ID</li>
            </ul>
          </li>
        </ul>
      </li><br>
      <li>The following parameters are supported for <b>secure command batches</b>:
        <ul><br>
          <li><b>type</b> [<i>string</i>] - must be "SecCmdBatch"
          </li>
          <li><b>cmds</b> [<i>comma seperated list of strings</i>] - each
            string is executed as a single command</li>
        </ul>
      </li><br>
      <li>The following parameters are supported for <b>both types</b>:
        <ul><br>
          <li><b>html-header-fields</b> [<i>array of json objects (no arrays)</i>], only
            supported in POST/JSON  - allows to manually set HTTP header
            fields that are used to download the resource (e.g. if
            authentication required)
          </li> 
        </ul>
      </li>
    </ul>
  </li>
<!--
  <li><i>/job/add</i> - add jobs
    <ul>
      <li>Jobs can be added through either POST or GET http requests.
        <ul>
          <li>POST request - expects a JSON file describing the job parameters
            (see Examples below).
          </li> 
          <li>GET request - to easily add a job from e.g. a webbrowser,
            transcoder accepts GET requests with parameters in the request line
            (see Examples below).
          </li> 
          <li>Return value:
            <ul>
              <li>default: returns ID of new job if successful (ie job doesn't
                already exist), if the job already exists its ID is returned, 0
                in case of errors
              </li> 
              <li>if 'redirect' (see list of parameters below): it will return
                a 302 (redirect) HTTP code with an adress derived from the job
                (ID, output type) and the delivery_service command line
                parameter of transcoder
              </li> 
            </ul>
          </li>
        </ul>
      </li>
      <li>The following parameters are supported:
        <ul>
          <li><b>resource</b> [<i>string</i>] - uri that gets pulled
          </li>
          <li><b>ops</b> [<i>comma seperated list of strings</i>]
            <ul>
              <li><b>optimizations</b> (note that you should not attempt this
              operation <i>after</i> converting to e.g. binary or image
              geometry - <b>ops order does matter</b>!):
                <ul> 
                  <li><i>collapse</i> - merge all objects ignoring materials -
                    the result will look <i>different</i> (only one
                    material)
                  </li> 
                  <li><i>collapse+id</i> - like collapse, but will also
                    generate an idmap
                  </li> 
                  <li><i>restructure</i> - (1) merge <i>same materials</i> (2)
                    split into nodes with max 64k vertices - the result will
                    look <i>identical</i>, but is optimized for rendering
                  </li> 
                  <li><i>restructure+id</i> - like restructure, but will also
                    generate an idmap
                  </li> 
                  <li><i>restructure_atlas</i> - (1) merge <i>same
                      materials</i> (2) merge w/ texture atlas (3) split into
                    nodes with max 64k vertices - the result will
                    look <i>identical</i>, but is optimized for rendering
                  </li> 
                  <li><i>restructure_atlas+id</i> - like restructure_atlas,
                    but will also generate an idmap
                  </li> 
                  <li><i>collapse_restructure</i> - (1) merge <i>all objects
                      ignoring materials</i> (2) split into nodes with max 64k
                    trianlges - the result will look <i>different</i> and is max
                    optimized for rendering
                  </li> 
                  <li><i>collapse_restructure+id</i> - like
                    collapse_restructure, but will also generate an idmap
                  </li>
                  <li><i>reuse</i> - attempts to identify subtrees that can be
                    referenced
                  </li> 
                </ul>
              </li>
              <li><b>conversions</b>:
                <ul>
                  <li><i>toBinGeo</i> - convert to Binary geometry</li>
                  <li><i>toPopGeo</i> - convert to POP geometry</li>
                  <li><i>toSRC</i> - convert to SRC geometry</li>
                  <li><i>toImageGeo</i> - convert to Image Geometry (not
                    recommended anymore since feature is deprecated)
                  </li> 
                </ul>
              </li>
            </ul>
          </li>
          <li><b>format</b> [<i>string</i>] - the output format
            <ul>
              <li><b>x3d</b> - X3D</li>
              <li><b>vrml</b> - VRML</li>
              <li><b>html</b> - HTML5/X3DOM</li>
              <li><b>json</b> - HSI</li>
            </ul>
          </li>
          <li><b>redirect</b> [<i>boolean, default: false</i>] - if true and
            delivery_service is set, job/add returns 302 redirect to result
          </li> 
          <li><b>html-header-fields</b> [<i>array of strings</i>], only
            supported in POST/JSON, not GET - allows to manually set HTTP header
            fields that are used to download the resource (e.g. if
            authentication required)
          </li> 
        </ul>
      </li>
    </ul>
  </li>-->
</ul>

<h2>Examples</h2>

<h3> Predefined Operations </h3>

<p>POST JSON: http://transcoder_server:4711/job</p>
<pre>
  {
    "ServiceClass" : "TranscoderService"
    "Parameters"   :
    {
      "type"     : "PreDefOps"
      "resource" : "http://wherever/some_data.dae",
      "ops"      : "restructure,toBinGeo",
      "format"   : "x3d",
      "reply"    : "result",

      "html-header-fields" : 
      [
        { "Cookie" : "SESSION=SOMECOOKIEDATADONTMINDME "}
      ]
    }
  }
  </pre>

<h3> Secure Command Batch</h3>

<p>POST JSON: http://transcoder_server:4711/job</p>
<pre>
  {
    "ServiceClass" : "TranscoderService"
    "Parameters"   :
    {
      "type" : "SecCmdBatch"
      "cmds" : [ "aopt -i http://wherever/some_data.dae -x index.x3d" ]
      "html-header-fields" : 
      [
        { "Cookie" : "SESSION=SOMECOOKIEDATADONTMINDME "}
      ]
    }
  }
  </pre>

</body></html>

